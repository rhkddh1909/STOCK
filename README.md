# 카카오페이증권 과제평가

!!요구사항에 대한 분석 및 설계 정리
1. 한개의 테이블(주식코드(key), 주식명, 주식 시작가, 주식 현재가, 주식 매도량, 주식 매수량, 조회수)
- 테이블을 1개로 활용한 이유는 요구사항의 볼륨에 있어서 모든 컬럼들이 주식코드를 키값으로 드라이빙 가능 하여 많은 테이블이 필요하다고 판단 되지 않았기 때문입니다..
- partioning과 shard를 사용하지 않았습니다. 테이블 볼륨을 고려해 불필요하다고 판단했습니다.
- 주식시장의 특성상 실시간정보를 빠르게 보여주기위해 dirty checking을 활용하였고 dirty checking에서 여러개의 테이블을 update 하지 않기 위해 하나의 테이블로 구성하였습니다.
2. 조회되는 데이터에 관하여 해당주식의 시장 코드를 조건으로 하여 조회하는 경우가 많으므로 시장 코드에 index설정
- 조회에 기준이 되는 많이본, 많이 오른, 많이 내린, 많이 거래된의 기준이 되는 컬럼들이 빈번히 update(실시간 정보) 되는 요구사항을 가졌기 때문에 인덱싱 단편화를 고려하여 굳이 인덱스를 걸지 않았습니다.
- 주식에 대한 정보를 가지는 테이블이기 때문에 현재 코스피 상장 기업을 고려하여 데이터가 수백만 수천만으로 늘어 날거라고 예상 되지 않기 때문에 따로 인덱싱처리를 하지 않았습니다.
3. queryDsl을 활용하여 구현하였습니다. 
- 쿼리 결과를 dto로 바로 내려 받을 수 있습니다. 
- 쿼리를 정적, 동적으로 활요하기 편하며 추후 필요한 경우 커버링 인덱스를 활용가능합니다.
- 동적 쿼리 작성이 편리합니다.
- 코드로 쿼리를 작성하므로 컴파일 시점에서 오류 확인 가능합니다.
4. 기능별 테스트코드를 작성하였고 tdd방식으로 구현하려고 노력하였습니다.
- 각 클래스의 메서드를 기준으로 기능별 테스트코드를 작성하였습니다.
5. 실시간데이터 변동의 기준
- 현재가의 변동을 랜덤으로 설정하였으며, 이를 기준으로 나머지 거래량, 매수, 매도를 결정하였습니다.
- 현재가의 단위는 코스피 호가에 맞춰 계산하였습니다.
- 현재가와 시작가를 비교하여 주식의 상승률을 계산하였습니다.
- 계산된 상승률을 기준으로 상승률의 일정 구간마다 조회수, 매도, 매수를 범위에 맞게 랜덤 상승 하였습니다.
- 매도량과 매수량을 비교하여 거래량을 계산하였습니다.
- 당일 상승률과 하락률은 +-30%를 넘지 못하도록 하였습니다.
- 상승률이 +-30%를 넘는 현재가가 측정되면 현재가, 매도, 매수를 변동 시키지 않았습니다.
- 조회수는 상승률과 관계없이 증가 할 수 있도록 설정하였습니다.
6. HTTP GET 방식으로 통일
- 사용자의 측면에서 명확한 CUD를 활용하는 기능이 없기 때문입니다.
- PARAM값 또한 특별하게 DB데이터에 지장을 주는 PARAM값이 요구되지 않기 때문입니다.
- 순위변동 API 또한 랜덤 값을 통해 DB의 값을 변경하는 기능이기 때문에 GET방식으로 구현하였습니다.
7. EXCEPTION과 RESPONSE CODE
- EXCEPTION은 조회 API에 대해서 특정응답 값이 존재하지 않을 경우에만 활요할 수 있도록 EXCEPTION을 활용 하였습니다.
- RESPONSE CODE로는 정상, 에러 값만 포함하고 있으며, 특정 EXCEPTION을 읽어 처리 하도록 하였습니다.
- enum을 활용하여 RESPONSE CODE를 구성하였습니다.

(추가기능)
1. 시장정보 테이블(시장코드(key), 시장이름, 시장오픈여부,시장국가, 시장회차)
- 시장정보를 저장하는 테이블을 생성
- 장시작, 장종료를 관리하는 테이블이며 각 주식시장마다 회차를 가지고 이력을 관리합니다.
- 장종료시 해당 장 회차에 맞는 정보를 주식 이력 테이블에 적재합니다.
2. 주식 이력 테이블(회차(KEY), 시장코드(KEy), 시장명, 주식 코드, 주식명, 주식 시작가, 주식 종료가, 매도량, 매수량, 거래량, 상승률, 조회수)
- 복합키로 이루어져 있으며 장시작과 장종료 동안 이루어진 거래에 대한 정보를 저장하는 테이블입니다.
- 많은 데이터가 적재될 것을 고려하여 주식코드에 index를 걸어 조회합니다.
- 사용자가 지정한 회차만큼의 주식정보이력을 그룹핑하여 각 기준(조회수, 상승률, 거레량)으로 Top20을 조회하여 최근 동향을 조회할 수 있는 기능을 위해 설계하였습니다.

구현된 API 목록
